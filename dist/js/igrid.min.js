(function(at){at.fn.igrid=function(aM){if(!at(this).is("table")){throw Error("Igrid element must be a table!")}var aL=at(this).data("guid");return v[aL]?v[aL].igrid:new ap(this,aM)};var K=0,az=null,v={};var a={cols:[],customCol:undefined,singleSelect:false,multiSelect:false,showRowNum:true,data:[],remote:true,head:{enable:false},request:{cache:false,loadonce:true,param:{},sord:1,sidx:undefined,url:undefined,mtype:"POST"},summation:{enable:false,data:null},paginator:{paging:true,pageSizeList:[10,20,50],pageSize:10,pageIndex:1,records:0,pageCount:0},lang:"en",handler:{},icons:{prefix:"fa",sort:"sort",sortAsc:"sort-asc",sortDesc:"sort-desc",plus:"plus",minus:"minus",popup:"angle-double-up",recoil:"angle-double-down",sub:"level-up rotate-90"},subGrid:{enable:false,options:null}};function A(){var aM=K++,aL;do{aL=(((1+Math.random())*65536)|0).toString(16)}while(v[aL+aM]);return aL+aM}function ap(aP,aO){var aN=A();at(aP).data("guid",aN);var aM=at("<div class='igrid igrid-panel'>").insertBefore(aP).append(aP);var aL=at("<div class='igrid igrid-root'>").insertBefore(aM).append(aM);v[aN]=at.extend(true,{guid:aN,grid:aP,root:aL,panel:aM,igrid:this},a,aO);ab(v[aN]);this.guid=aN}ap.prototype={version:"1.0.0",constructor:ap,getOption:function(aL){return aL===undefined?v[this.guid]:v[this.guid][aL]},load:function(aM){var aL=v[this.guid];if(aM&&at.isArray(aM)){aL.data=t(aM,aL.cols)}if(aL.paginator.paging){R(H(aL))}au(aL);return aL.igrid},reload:function(aM){var aL=v[this.guid];if(aM){aL.paginator.pageIndex=1}if(at.isArray(aM)){aL.data=t(aM,aL.cols);if(v[this.guid].paginator.paging){R(H(aL))}au(aL)}else{if(aL.remote){if(typeof aM=="object"){aL.request.param=aM}al(aL)}}return aL.igrid},search:function(aM){var aL=v[this.guid];if(!aL.request.cache&&aL.remote){return this.reload(aM)}o(aL,aM);return aL.igrid},update:function(aN,aL){var aM=v[this.guid];if(!aM.request.loadonce){return aM.igrid}w(aM,aN,aL);this.refresh();return aM.igrid},clear:function(){var aL=v[this.guid];aL.data=[];R(H(aL));au(aL);return aL.igrid},refresh:function(){au(v[this.guid]);return v[this.guid].igrid},showCol:function(aM){var aL=v[this.guid];u(aL.grid,aM,true);return aL.igrid},hideCol:function(aM){var aL=v[this.guid];u(aL.grid,aM,false);return aL.igrid},toggleCol:function(aN,aL){var aM=v[this.guid];u(aM.grid,aN,aL);return aM.igrid},addRowData:function(aQ,aP){var aO=v[this.guid];if(aO.remote&&!aO.request.loadonce){throw Error("Remote data cannot be added here!")}var aM=aO.data?aO.data.length:0;if(!aP&&typeof aQ=="object"){aP=aQ;aQ=aM+1}if(at.isEmptyObject(aP)){throw Error("The argument 'data' is empty.")}aQ=Math.min(Math.max(aQ,1),aM+1);af(aO,aQ,aP);if(!aO.paginator.paging){au(aO);return aO.igrid}var aL=aO.paginator.pageIndex;var aN=aO.paginator.pageSize*aO.paginator.pageIndex;if(aQ>aN){aL=Math.ceil(aQ/aO.paginator.pageSize);if(aL>aO.paginator.pageCount){aO.paginator.pageCount++}}j(aO,aL);return aO.igrid},addMultiRowDatas:function(aQ,aP){var aO=v[this.guid];if(!aO.request.loadonce){throw Error("Remote data cannot be added here!")}var aM=v[this.guid].data?v[this.guid].data.length:0;if(!aP&&typeof aQ=="object"){aP=aQ;aQ=aM+1}if(!at.isArray(aP)){throw Error("The argument 'rows' must be an array.")}aQ=Math.min(Math.max(aQ,1),aM+1);b(aO,aQ,aP);if(!aO.paginator.paging){au(aO);return aO.igrid}var aL=aO.paginator.pageIndex;var aN=aO.paginator.pageSize*aO.paginator.pageIndex;aQ+=aP.length-1;if(aQ>aN){aL=Math.ceil(aQ/aO.paginator.pageSize);if(aL>aO.paginator.pageCount){aO.paginator.pageCount++}}j(aO,aL);return aO.igrid},setRowData:function(aO,aN){if(!aN||at.isEmptyObject(aN)){throw Error("The argument 'data' is empty.")}var aL=v[this.guid];var aM=aL.grid.find("tr[data-ridx='"+aO+"']");if(aM.length==0){throw Error("Row index out of range.")}ak(aL,aO,aN);au(aL);return aL.igrid},getRowData:function(aL){return M(v[this.guid],aL)},delRowData:function(aM){var aL=v[this.guid];if(aM>aL.data.length||aM<0){throw new Error("ridx is out of range.")}g(aL,aM);if(!aL.paginator.paging){au(aL);return aL.igrid}j(aL,aL.paginator.pageIndex);return aL.igrid},delMultiRowDatas:function(aL){var aM=v[this.guid];if(!at.isArray(aL)){throw Error("The argument 'ridxes' must be an array.")}if(aL.length==0){return aM.igrid}F(aM,aL);if(!aM.paginator.paging){au(aM);return aM.igrid}j(aM,aM.paginator.pageIndex);return aM.igrid},getSelectedRow:function(){var aL=v[this.guid].grid.find("tr.selected");if(aL.length==0){return null}return M(v[this.guid],parseInt(aL.attr("data-ridx"),10))},getSelectedRowIdx:function(){var aL=v[this.guid].grid.find("tr.selected");if(aL.length==0){return undefined}return parseInt(aL.attr("data-ridx"),10)},setSelectedRowData:function(aM){var aL=v[this.guid].grid.find("tr.selected");if(aL.length==0){throw Error("No row selected.")}var aN=parseInt(aL.attr("data-ridx"),10);return this.setRowData(aN,aM)},delSelctedRow:function(){var aL=v[this.guid].grid,aM=aL.find("tr.selected");if(aM.length==0){throw Error("No row selected.")}aM.each(function(){var aN=parseInt(at(this).attr("data-ridx"),10);at(this).remove();aL.find("tr[data-ridx]").each(function(){var aO=parseInt(at(this).attr("data-ridx"),10);if(aO>aN){at(this).attr("data-ridx",aO-1);at(this).find("td.ridx").text(aO-1)}});g(v[this.guid],aN)});return v[this.guid].igrid},getMultiSelectedRows:function(){var aL=v[this.guid].grid.find("tr.selected").not(".sum");if(aL.length==0){return null}var aN=[];for(var aM=0;aM<aL.length;aM++){aN.push(M(v[this.guid],parseInt(at(aL[aM]).attr("data-ridx"),10)))}return aN},getMultiSelectedRowIdxes:function(){var aL=v[this.guid].grid.find("tr.selected").not(".sum");var aM=[];for(var aN=0;aN<aL.length;aN++){aM.push(parseInt(at(aL[aN]).attr("data-ridx"),10))}return aM},setRowSelected:function(aO){var aM=v[this.guid];var aN=aM.grid.find("tr[data-ridx='"+aO+"']");if(aN.length==0){throw Error("Row index out of range.")}if(!aM.multiSelect){this.resetSelection()}aN.addClass("selected");aN.find(".igrid-check input:checkbox, .igrid-radio input:radio").prop("checked",true);var aL=aM.grid.find("tbody input:checked");if(aL.length==aM.paginator.pageSize){aM.grid.find("thead input:checkbox").prop("checked",true)}return aM.igrid},setRowUnselected:function(aO){var aM=v[this.guid];var aN=aM.grid.find("tr[data-ridx='"+aO+"']");if(aN.length==0){throw Error("Row index out of range.")}aN.removeClass("selected");aN.find(".igrid-check input:checkbox, .igrid-radio input:radio").prop("checked",false);var aL=aM.grid.find("tbody input:not(:checked)");if(aL.length==aM.paginator.pageSize){aM.grid.find("thead input:checkbox").prop("checked",false)}return aM.igrid},getData:function(){if(!this.valid()){X("you have some wrong data in the grid, please check your input and try again.");return null}return v[this.guid].data||[]},getCurPageData:function(){return f(v[this.guid])},setCell:function(aO,aM,aL){var aN=v[this.guid].grid.find("tr[data-ridx='"+aO+"'] td[data-field='"+aM+"']");if(aN.length==0){throw Error("Can not find the cell of row["+aO+"] column["+aM+"] .")}aN.html(aL);aD(v[this.guid],aO,aM,aL);return v[this.guid].igrid},getCell:function(aN,aL){var aM=v[this.guid].grid.find("tr[data-ridx='"+aN+"'] td[data-field='"+aL+"']");if(aM.length==0){throw Error("Can not find the cell of row["+aN+"] column["+aL+"] .")}return aJ(v[this.guid],aN,aL)},editCell:function(aO,aM){var aL=v[this.guid];var aN=aL.grid.find("tr[data-ridx='"+aO+"'] td[data-field='"+aM+"']");if(aN.length==0){throw Error("Can not find the cell of row[{0}] column[{1}] .".format(aO,aM))}aa(aN,aL.isWebKit);return aL.igrid},saveCell:function(aQ,aO){var aM=v[this.guid];var aP=aM.grid.find("tr[data-ridx='"+aQ+"'] td[data-field='"+aO+"']");if(aP.length==0){throw Error("Can not find the cell of row[{0}] column[{1}] .".format(aQ,aO))}var aL=aM.isWebKit?aP:aP.find("[contenteditable]");var aN=q(aL,aQ,aO,aM);if(aN===false){return false}aP.removeClass("editable").html(aN).prop("contenteditable",false);return aM.igrid},saveRow:function(aN){var aL=v[this.guid];var aM=aL.grid.find("tr[data-ridx='"+aN+"']");if(aM.length==0){throw Error("Can not find the row[{0}] .".format(aN))}aM.find("td.editable").each(function(){var aO=aL.isWebKit?at(this):at(this).find("[contenteditable]");var aP=q(aO,aN,field,aL);if(aP===false){return false}at(this).removeClass("editable").html(aP).prop("contenteditable",false)});return aL.igrid},resetSelection:function(){var aL=v[this.guid];aL.grid.find("tr.selected").removeClass("selected");aL.grid.find(".igrid-check input:checkbox, .igrid-radio input:radio").prop("checked",false);return aL.igrid},destroy:function(){var aL=v[this.guid];aL.grid.off("click","tbody td").off("dblclick","tbody td").off("blur","tbody td").empty().data("guid",undefined).insertBefore(aL.root);aL.root.remove();at("#igrid-"+this.guid+"-waiting").remove();v[this.guid]=null},storeStatus:function(aN){var aM=v[this.guid];var aL={url:aq(aM.request.url),page:aM.paginator.pageIndex,size:aM.paginator.pageSize,row:aN,param:aM.request.param};sessionStorage.setItem("igridStatus",JSON.stringify(aL))},valid:function(){return v[this.guid].grid.find(".input-error").length==0}};function aI(){var aL=sessionStorage.igridStatus;if(aL){aL=JSON.parse(aL)}return aL}function aq(aL){var aM;if(aL&&aL.indexOf("/")<=0){aM=location.pathname.split("/");aM.splice(aM.length-1,1,aL);aM=aM.join("/")}return aM||aL}function O(aL,aN){for(var aM=0;aM<aL.length;aM++){if(aL[aM].field==aN){return true}}return false}function ab(aL){aL.isWebKit=navigator.userAgent.toLowerCase().contains("webkit");aL=m(aL);if(aL.width){aL.root.width(aL.width)}if(aL.height){aL.grid.parent().height(aL.height)}if(aL.head.enable){Q(aL)}if(aL.paginator.paging){h(H(aL))}else{aL.paginator.pageSize=Infinity}ay(aL);aG(aL);z(aL)}function ay(aM){if(az){return}az={};var aO=aM.icons.prefix;az.prefix=aO;for(var aN in aM.icons){if(aN!="prefix"){var aL=aM.icons[aN].split(" ");az[aN]=aL.select(function(aP){return aO+"-"+aP}).join(" ")}}}function m(aM){if(!aM){throw Error("init options undefined!")}if(aM.cols.length==0){throw Error("cols has no element!")}if(aM.singleSelect&&aM.multiSelect){throw Error("singleSelect and multiSelect can not be true at the same time!")}if(isNaN(parseInt(aM.request.sord,10))){aM.request.sord=1}if(!aM.request.sidx||!O(aM.cols,aM.request.sidx)){aM.request.sidx=aM.cols[0].field}if(isNaN(parseInt(aM.paginator.pageIndex))||aM.paginator.pageIndex<=0){aM.paginator.pageIndex=1}var aL=aI();if(aL&&aL.url==aq(aM.request.url)){aM.paginator.pageIndex=aL.page;aM.paginator.selectedRow=aL.row;aM.request.param=aL.param;sessionStorage.removeItem("igridStatus")}return aM}function z(aL){N(aL);B(aL);y(aL)}function B(aL){aL.grid.on("click","tbody td",function(){if(at(this).parent().hasClass("igrid-sub-tr")){return}var aO=at(this).parent(),aQ=parseInt(aO.attr("data-ridx"),10),aP=aL.igrid.getRowData(aQ);if(aL.multiSelect){var aN=aO.find(".igrid-check input:checkbox"),aM=!aN.prop("checked");aN.prop("checked",aM);aO.toggleClass("selected",aM);ad(aL,aM,aP,aQ)}else{if(!aO.hasClass("selected")){aO.parent().find("tr.selected").removeClass("selected");aO.addClass("selected");if(aL.singleSelect){aO.parent().find("tr.selected").find(".igrid-radio input:radio").prop("checked",true);ad(aL,true,aP,aQ)}}else{aO.removeClass("selected");if(aL.singleSelect){aO.find(".igrid-radio input:radio").prop("checked",false);ad(aL,false,aP,aQ)}}}if(typeof aL.handler.onCellClick=="function"){aL.handler.onCellClick.call(null,aQ,aO.hasClass("selected"))}});aL.grid.on("click","tbody td input:radio",function(aN){var aM=at(this).parent().parent(),aP=parseInt(aM.attr("data-ridx"),10),aO=aL.igrid.getRowData(aP);if(!aM.hasClass("selected")){aM.parent().find("tr.selected").removeClass("selected");aM.addClass("selected");ad(aL,true,aO,aP)}else{ad(aL,false,aO,aP)}aN.stopPropagation()});aL.grid.on("click","tbody td input:checkbox",function(aO){var aN=at(this).parent().parent(),aM=at(this).prop("checked"),aQ=parseInt(aN.attr("data-ridx"),10),aP=aL.igrid.getRowData(aQ);aN.toggleClass("selected",aM);ad(aL,aM,aP,aQ);aO.stopPropagation()});aL.grid.on("click","tbody td.igrid-sub-icon",function(){var aP=at(this).parent(),aN=aP.next("tr.igrid-sub-tr"),aM=at(this).index();if(aP.hasClass("open")){aP.removeClass("open");at(this).find("i").removeClass(az.minus).addClass(az.plus);aN.hide()}else{aP.addClass("open");at(this).find("i").removeClass(az.plus).addClass(az.minus);if(aN.length>0){aN.show();return}aN=at("<tr class='igrid-sub-tr'></tr>");var aO="<td><i class='{0} {1}'></i></td>".format(az.prefix,az.sub);aN.append(aM==0?aO:"<td colspan='"+aM+"'></td>"+aO);aA(aP,aN,aL)}});aL.grid.find("thead th.sortable").click(function(){at(this).parent().find("th.sortable").not(this).find("i").removeClass(az.sortAsc+" "+az.sortDesc).addClass(az.sort).css({color:""});var aM=at(this).find("i");if(aM.hasClass(az.sortAsc)){aM.removeClass(az.sortAsc).addClass(az.sortDesc);aL.request.sord=-1}else{aM.removeClass(az.sort+" "+az.sortDesc).addClass(az.sortAsc);aL.request.sord=1}aL.request.sidx=at(this).data("sortfield");E(aL)});aL.grid.on("click",".editable input, .editable select, .editable checkbox",function(aN){var aM=at(this).parent().parent();if(!aM.hasClass("selected")){aM.parent().find("tr.selected").removeClass("selected");aM.addClass("selected")}aN.stopPropagation()});aL.grid.find("thead .igrid-check input:checkbox").click(function(){var aM=at(this).prop("checked");aL.grid.find("tbody .igrid-check input:checkbox").prop("checked",aM);aL.grid.find("tbody  tr").toggleClass("selected",aM);aj(aL,aM)});aL.grid.find("thead .igrid-radio input:radio").click(function(){aL.grid.find("tbody .igrid-radio input:radio").prop("checked",false);aL.grid.find("tbody  tr").removeClass("selected")});if(typeof aL.handler.onCellDblClick=="function"){aL.grid.on("dblclick","tbody td",function(){var aM=at(this).parent(),aO=parseInt(aM.attr("data-ridx"),10),aN=aL.igrid.getRowData(aO);aL.handler.onCellDblClick.call(null,aN,aO)})}aL.grid.on("click","thead th.igrid-header-control",function(){var aM=aL.root.find(".igrid-header");if(aM.is(":visible")){aM.hide("slide");at(this).find("i").removeClass().addClass(az.prefix+" "+az.popup)}else{aM.show("slide");at(this).find("i").removeClass().addClass(az.prefix+" "+az.recoil)}})}function N(aL){aL.root.on("click",".igrid-header input:checkbox",function(){u(aL,this.value,at(this).prop("checked"))})}function ad(aM,aL,aN,aO){if(aL){if(typeof aM.handler.onSelectRow=="function"){aM.handler.onSelectRow.call(null,aN,aO)}}else{if(typeof aM.handler.onDeSelectRow=="function"){aM.handler.onDeSelectRow.call(null,aN,aO)}}}function aj(aM,aL){if(aL){if(aM.handler.onSelectAll&&typeof aM.handler.onSelectAll=="function"){aM.handler.onSelectAll.call(null,f(aM))}}else{if(aM.handler.onDeSelectAll&&typeof aM.handler.onDeSelectAll=="function"){aM.handler.onDeSelectAll.call(null,f(aM))}}}function aK(aL,aN){var aM=[],aO=0;aN.forEach(function(aQ,aP){if(!aQ.cols){throw Error("subgrid options requires cols !")}aO+=aM[aP]=aQ.cols.count(function(aR){return !aR.hide})});return aM.select(function(aP){return Math.floor((aP/aO)*aL)})}function aA(aP,aM,aL){if(!at.isArray(aL.subGrid.options)){aL.subGrid.options=[aL.subGrid.options]}var aO=aK(aL.cols.count(function(aQ){return !aQ.hide}),aL.subGrid.options);var aN=[];aL.subGrid.options.forEach(function(aR,aQ){var aS=at("<table></table>").addClass(aL.grid.attr("class"));var aV=parseInt(aP.attr("data-ridx"),10);var aT=aL.igrid.getRowData(aV);if(typeof aR.data=="function"){aR.data=aR.data.call(null,aT)}if(typeof aR.paramFn=="function"){aR.request.param=aR.paramFn.call(null,aT,aV)}var aU=at("<td colspan='{0}' data-idx='{1}'></td>".format(aO[aQ],aQ));aM.append(aU.append(aS));aN.push({grid:aS,opt:aR})});aP.after(aM);aN.forEach(function(aQ){aQ.grid.igrid(aQ.opt)})}function Q(aL){var aN="<div class='igrid igrid-header'>{0}</div>";var aM="<div class='input-group'><span class='input-group-addon'><strong>显示以下列</strong></span>";aM+="<div class='checkbox-group multiple-line-group'>";aL.cols.forEach(function(aO){if(!aO.fixed){aM+="<label class='checkbox-inline'>"+"<input type='checkbox' value='{0}' {1} />".format(aO.field,(!aO.hide?" checked='checked'":""))+aO.label+"</label>"}});aM+="</div></div>";aL.panel.before(aN.format(aM))}function u(aN,aM,aL){var aP=aN.grid,aQ=aN.cols;if(typeof aM=="string"){aM=aM.split(",")}if(!at.isArray(aM)){throw new Error("col must be an array of string or a string!")}if(aL){aM.forEach(function(aR){aQ.first(function(aS){return aS.field==aR}).hide=false;aP.find("th[data-field='"+aR+"'], td[data-field='"+aR+"']").removeClass("hide")})}else{aM.forEach(function(aR){aQ.first(function(aS){return aS.field==aR}).hide=true;aP.find("th[data-field='"+aR+"'], td[data-field='"+aR+"']").addClass("hide")})}if(aN.subGrid.enable){var aO=aK(aQ.count(function(aR){return !aR.hide}),aN.subGrid.options);aP.find("tr.igrid-sub-tr td[data-idx]").each(function(){at(this).attr("colspan",aO[at(this).data("idx")])})}aP.find("tr.subtotal").html(S(aN,"subtotal","小计"));aP.find("tr.sum").html(S(aN,"data","总计"))}function y(aL){aL.grid.on("blur","[contenteditable='true']",function(){var aR=aL.isWebKit?at(this):at(this).parent(),aO=aR.parent(),aP=aR.data("field"),aQ=parseInt(aO.attr("data-ridx"),10);var aM=aL.cols.first(function(aS){return aS.field==aP});if(aM.edit&&aM.edit.enable){var aN=q(at(this),aQ,aP,aL);at(this).html(i(aN,aM,aQ,aL.igrid.getRowData(aQ)))}});aL.grid.on("keydown","[contenteditable='true']",function(aP){if(aP.shiftKey||aP.ctrlKey){return}var aQ=aL.isWebKit?at(this):at(this).parent();var aN=aP.which||aP.code,aM=aQ.data("index"),aO=null;if(aN==37){aO=aQ.prev("td.editable")}if(aN==39){aO=aQ.next("td.editable")}if(aN==40){aO=aQ.parent().next("tr").find("td[data-index='"+aM+"'].editable")}if(aN==38){aO=aQ.parent().prev("tr").find("td[data-index='"+aM+"'].editable")}if(aO&&aO.length>0){aO=aL.isWebKit?aO:aO.find("[contenteditable='true']");aO.focus()}})}function q(aL,aQ,aP,aN){if(aL.children().length>0){aL.html(aL.children()[0].innerHTML)}var aM=aN.cols.first(function(aR){return aR.field==aP});var aO=L(aM,aP,aL.html());aL.html(aO||aL.html());if(typeof aN.handler.beforeCellSave=="function"){aO=aN.handler.beforeCellSave.call(null,aO,aP,aQ)}if(aO===false){am(aL);return false}aw(aN,V(aN,aQ),aP,aO);if(typeof aN.handler.afterCellSave=="function"){aN.handler.afterCellSave.call(null,aO,aP,aQ)}r(aL);return i(aO,aM,aQ,M(aN,aQ))}function L(aM,aO,aL){if(!aM.edit){return aL}var aN=aL;if(aM.edit.type=="integer"){aN=I.toInt(aN,true);if(aL&&isNaN(aN)){X("please input a integer");return false}}if(aM.edit.type=="decimal"){aN=I.toFloat(aN,true);if(aL&&isNaN(aN)){X("please input a number");return false}}var aP=aM.edit.rules;if(aP){if(aP.hasOwnProperty("min")&&aN<aP.min){X("{0}c annot be less then {1}".format(aM.label,aP.min));return false}if(aP.hasOwnProperty("max")&&aN>aP.max){X("{0} cannot be greeter then {1}".format(aM.label,aP.max));return false}}return aN}function aw(aM,aL,aO,aN){aM.data[aL][aO]=aN}function am(aL){aL.addClass("input-error")}function r(aL){aL.removeClass("input-error")}function aG(aL){if(aL.caption){aL.grid.append("<caption>"+aL.caption+"</caption>")}av(aL);ar(aL)}function ar(aL){if(aL.remote&&(!aL.data||aL.data.length==0)){al(aL)}else{ac(aL);aL.grid.append(an(aL));G(aL)}}function av(aM){if(aM.cols.length==0){throw Error("cols has no element!")}var aN="<thead><tr>",aL=aM.head.enable,aO=aL?"<i class='{0} {1}'></i>".format(az.prefix,az.popup):"";if(aM.showRowNum){aN+="<th class='ridx {0}'>".format(aL?"igrid-header-control":"");if(aL){aN+=aO}aN+="</th>"}if(aM.singleSelect){aN+="<th class='igrid-radio'><input type='radio' value='none' /></th>"}if(aM.multiSelect){aN+="<th class='igrid-check'><input type='checkbox' value='all' /></th>"}if(aM.subGrid.enable){aN+="<th class='igrid-sub-icon'></th>"}aN+=aE(aM);if(aM.customCol){aN+=("<th {0}>"+aM.customCol.label+"</th>").format(aM.customCol.width?"style='width:{0}px;'".format(aM.customCol.width):"")}aN+="</tr></thead>";aM.grid.append(aN)}function aE(aU){var aS="";for(var aR=0;aR<aU.cols.length;aR++){var aO=aU.cols[aR],aL="",aT="",aQ="",aN=aO.label,aM="<th data-field='{0}' class='{1}' style='{2}' {3}>{4}</th>";if(aO.hide){aT+=" hide "}if(aO.width){aL+="width:"+aO.width+"px;"}if(aO.sortable){aT+=" sortable ";aQ+="data-sortfield='"+(aO.sortfield||aO.field)+"'";var aP=aU.request.sidx==aO.field?(aU.request.sord>0?az.sortAsc:az.sortDesc):az.sort;aN+="<i class='{0} {1}'></i>".format(az.prefix,aP)}aS+=aM.format(aO.field,aT,aL,aQ,aN)}return aS}function an(aN){var aM=at("<tbody>"),aP=aN.data,aR=aN.request.loadonce?aN.paginator.pageSize*(aN.paginator.pageIndex-1)+1:1;if(aN.request.loadonce){if(aN.paginator.records>aN.paginator.pageSize){var aQ=aR-1;var aL=aN.paginator.pageSize*aN.paginator.pageIndex;aP=aP.slice(aQ,Math.min(aL,aN.paginator.records))}else{aR=1}}if(at.isArray(aP)&&aP.length>0){for(var aO=0;aO<aP.length;aO++){aM.append(s(aN,aR++,aP[aO]))}}if(aN.summation.enable){d(aN,aP);aM.append(k(aN)+J(aN))}return aM}function s(aL,aP,aO){var aN=at("<tr>").attr("data-ridx",aP);if(aL.showRowNum){aN.append(at("<td class='ridx'>").text(ah(aL,aP)))}if(aL.singleSelect){aN.append("<td class='igrid-radio'><input type='radio' value='"+aP+"' /></td>")}if(aL.multiSelect){aN.append("<td class='igrid-check'><input type='checkbox' value='"+aP+"' /></td>")}if(aL.subGrid.enable){aN.append("<td class='igrid-sub-icon'><i class='{0} {1}'></i></td>".format(az.prefix,az.plus))}for(var aM=0;aM<aL.cols.length;aM++){aN.append(aB(aL.cols[aM],aP,aO,aL.isWebKit))}if(aL.customCol){aN.append(e(aL.customCol,aP,aO))}if(aL.paginator.selectedRow==aP){aN.addClass("selected");aN.find(".igrid-radio input:radio, .igrid-check input:checkbox").prop("checked",true);delete aL.paginator.selectedRow}return aN}function k(aL){return"<tr class='subtotal'>{0}</tr>".format(S(aL,"subtotal","小计"))}function J(aL){return"<tr class='sum'>{0}</tr>".format(S(aL,"data","总计"))}function S(aU,aL,aS){var aQ="",aP=null,aT=0,aR=aU.cols.length;if(!aU.summation[aL]){return null}if(aU.showRowNum){aT++}if(aU.singleSelect){aT++}if(aU.multiSelect){aT++}if(aU.subGrid.enable){aT++}for(var aO=0;aO<aR;aO++){var aN=aU.cols[aO];if(aN.hide){continue}aT++;if(aN.sum){if(!aP){aP="<td colspan='{0}'>{1}：</td>".format(aT-1,aS);aQ+=aP}var aM=aU.summation[aL][aN.field];if(aN.format=="separate"){aM=aM.toSeparate()}else{if(aN.format=="money"){aM=ap.ToDecimalString(aM).toSeparate()}}aQ+="<td class='{0}'>{1}</td>".format(aN.align,aM)}else{if(aP){aQ+="<td></td>"}}}return aQ}function aB(aL,aR,aP,aO){var aQ=at("<td>").attr("data-field",aL.field),aN=aP[aL.field];var aM=i(aN,aL,aR,aP);if(aL.highlight){p(aQ,aN,aL.highlight,aR,aP)}T(aQ,aM,aL,aO);return aQ}function e(aN,aP,aM){var aO=at("<td>"),aL;if(typeof aN.content=="function"){aL=aN.content.call(null,aP,aM)}else{aL=aN.content}if(at.isArray(aL)){aL.forEach(function(aQ){aO.append(aQ)})}else{aO.html(aL===null||aL===undefined?"":aL)}return aO}function T(aO,aM,aL,aN){if(aL.format=="img"){aO.addClass("img")}if(aL.hide){aO.addClass("hide")}if(aL.align){aO.addClass(aL.align)}if(at.isArray(aM)){aM.forEach(function(aP){aO.append(aP)})}else{aO.append(aM)}if(aL.edit&&aL.edit.enable){aa(aO,aN)}}function aa(aN,aM){aN.addClass("editable");var aL=aN.html();if(!aM){aN.html("<div contenteditable='true'>{0}</div>".format(aL));aN.find("div[contenteditable]").focus()}else{aN.prop("contenteditable",true).focus()}}function i(aO,aM,aP,aN){switch(aM.format){case"separate":if(typeof aM.formatter=="function"){return aM.formatter.call(null,aO,aN,aP)}return aO.toSeparate();case"money":if(typeof aM.formatter=="function"){return aM.formatter.call(null,aO,aN,aP)}return I.toMoney(aO).toSeparate();case"select":if(typeof aM.formatter!="object"){throw Error("The formatter for select must be object!")}return aM.formatter[aO];case"checkbox":return"<input type='checkbox' disabled='disabled' {0} />".format(aO?"checked='checked'":"");case"date":return I.formatDate(aO,aM.formatter);case"link":var aL;if(typeof aM.formatter=="string"){aL=aM.formatter}else{if(typeof aM.formatter=="function"){aL=aM.formatter.call(null,aO,aN,aP)}else{throw Error("The formatter for link must be a string or a function which return a string !")}}if(aL&&!(aL instanceof at)&&!/^<\s*(\S+)(\s[^>]*)?>[\s\S]*<\s*\/\1\s*>$/.test(aL)){aL="<a href='"+aL+"' data-ridx='"+aP+"'>"+aO+"</a>"}return aL;case"img":return aM.formatter.call(null,aN);case"custom":if(typeof aM.formatter=="function"){aO=aM.formatter.call(null,aO,aN,aP)}return aO;case"percent":if(typeof aM.formatter=="function"){aO=aM.formatter.call(null,aO,aN,aP)}else{aO=parseFloat(aM.formatter?aO*100:aO).toFixed(2)+"%"}return aO;default:if(typeof aM.formatter=="function"){aO=aM.formatter.call(null,aO,aN,aP)}if(typeof aO=="string"){aO=aO.replace(/[\b\f\n\r\t\v]/g," ")}return(aO===undefined||aO===null)?"":aO}}function p(aQ,aO,aL,aP,aN){var aM="red";if(aL&&typeof aL=="object"){if(aL.factor&&typeof aL.factor!="function"){throw Error("factor of highlight must be a function!")}if(typeof aL.factor=="function"&&!aL.factor.call(null,aO,aN,aP)){return}aM=aL.color||aM;if(typeof aM=="function"){aM=aM.call(null,aO,aN,aP)}}aQ.css("color",aM)}function ah(aL,aM){return aL.request.loadonce?aM:aL.paginator.pageSize*(aL.paginator.pageIndex-1)+aM}function ax(aM,aN){if(!aM.request.loadonce&&aN.summation){aM.summation.data=aN.summation;return}if(aM.request.loadonce){var aL={};aM.cols.forEach(function(aO){if(aO.sum){aL[aO.field]=aM.data.sum(function(aP){return I.toFloat(aP[aO.field])})}});aM.summation.data=aL}}function d(aM,aN){var aL={};aM.cols.forEach(function(aO){if(aO.sum){aL[aO.field]=aN.sum(function(aP){return I.toFloat(aP[aO.field])})}});aM.summation.subtotal=aL}function h(aL){if(!aL){return}Z(aL);P(aL)}function H(aL,aN){if(!aL.paginator.paging){return false}if(!aL.paginator.pageSizeList.contains(aL.paginator.pageSize)){aL.paginator.pageSize=aL.paginator.pageSizeList[0]}aN=aN||aL.data;if(aL.request.loadonce){if(aN){aL.paginator.records=aN.length;var aM=aL.paginator.records%aL.paginator.pageSize;aL.paginator.pageCount=aM==0?aL.paginator.records/aL.paginator.pageSize:Math.floor(aL.paginator.records/aL.paginator.pageSize)+1;aL.paginator.pageIndex=Math.max(Math.min(aL.paginator.pageIndex,aL.paginator.pageCount),1)}}else{if(aN){aL.paginator.records=aN.records||0;aL.paginator.pageCount=aN.pageCount||0;aN=aN.list||[]}}aL.data=aN;return aL}function R(aL){if(!aL){return}aL.root.find(".igrid-paginator").remove();h(aL)}function Z(aL){var aN=n(aL.paginator,aL.lang);var aM=aC(aL.paginator,aL.lang);var aO="<div class='igrid igrid-paginator clearfix'>{0}</div>".format(aN+aM);aL.root.append(aO)}function n(aM,aL){return"<div class='igrid-paginator-left'>"+aF(aM.pageSizeList,aM.pageSize,aL)+"</div>"}function aC(aM,aL){return"<div class='igrid-paginator-right'>{0}{1}{2}</div>".format(ai(aM,aL),ag(aM,aL),x(aM,aL))}function P(aL){aL.root.find(".igrid-paginator .page-size").change(function(){aL.paginator.pageSize=parseInt(at(this).val(),10);j(aL,1)});aL.root.find(".igrid-paginator .page-number").keydown(function(aN){if(aN.which==13||aN.keyCode==13){var aM=parseInt(this.innerHTML,10);if(isNaN(aM)){aM=1}j(aL,aM)}});aL.root.find(".igrid-paginator .page-number-btn").click(function(){var aM=parseInt(aL.root.find(".igrid-paginator .page-number").html(),10);if(isNaN(aM)){aM=1}j(aL,aM)});aL.root.find(".igrid-paginator a[data-page-number]").not(".disabled").click(function(){var aN=at(this).data("page-number"),aM;switch(aN){case"first":aM=1;break;case"prev":aM=aL.paginator.pageIndex-1;break;case"next":aM=aL.paginator.pageIndex+1;break;case"last":aM=aL.paginator.pageCount;break;default:aM=parseInt(aN,10);break}if(aM==aL.paginator.pageIndex){return}j(aL,aM)})}function j(aM,aL){aM.paginator.pageIndex=Math.min(Math.max(1,aL),aM.paginator.pageCount);if(aM.request.loadonce){au(aM);R(H(aM))}else{al(aM)}}function aF(aM,aO,aN){var aL="<select class='page-size'>";aM.forEach(function(aP){aL+="<option value='{0}' {1} >{0}</option>".format(aP+D("unit",aN),aP==aO?"selected='selected'":"")});aL+="</select>";return aL}function ai(aM,aL){return"<span class='static-control'>{0},{1}</span>".format(D("total",aL).format("<strong>"+aM.pageCount+"</strong>","<strong>"+aM.records+"</strong>"),D("current",aL).format("<strong>"+aM.pageIndex+"</strong>"))}function ag(aR,aQ){var aL="<span class='pagination'>";if(aR.pageCount>0){var aP="<a href='javascript:void(0);' data-page-number='first' {0}>"+D("first",aQ)+"</a>";var aO="<a href='javascript:void(0);' data-page-number='prev' {0}>"+D("prev",aQ)+"</a>";aL+=(aP+aO).format(aR.pageIndex==1?"class='disabled'":"");var aM="<a href='javascript:void(0);' data-page-number='next' {0}>"+D("next",aQ)+"</a>";var aN="<a href='javascript:void(0);' data-page-number='last' {0}>"+D("last",aQ)+"</a>";aL+=(aM+aN).format(aR.pageIndex==aR.pageCount?"class='disabled'":"")}return aL+"</span>"}function x(aN,aM){var aL="<span contenteditable='true' class='page-number'>"+aN.pageIndex+"</span><button type='button' class='page-number-btn btn'>GO</button>";return aL}function al(aL){U(aL);var aM=at.extend(aL.request.param,{sord:aL.request.sord,sidx:aL.request.sidx||aL.cols[0].field});if(aL.paginator.paging&&!aL.request.loadonce){aM.pageIndex=aL.paginator.pageIndex;aM.pageSize=aL.paginator.pageSize}at.ajax({url:aL.request.url,data:aM,type:aL.request.mtype,contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"json"}).done(function(aN){aN=ae(aN);if(aN.Error){X(aN.Message);return}ac(aL,aN);au(aL)}).fail(function(aN){var aO=aN.responseJSON;X(aO?aO.Message:"请求失败！")}).always(function(){c(aL)})}function ae(aM){if(typeof aM=="string"){try{aM=JSON.parse(aM)}catch(aL){try{aM=JSON.parse(W(aM))}catch(aN){throw Error("An error occured when data was parsed to json.")}}}return aM||[]}function ac(aL,aM){aM=aM||aL.data;if(aM.list){aM.list=t(aM.list,aL.cols)}else{aM=ao(t(aM,aL.cols),aL.request.sord,aL.request.sidx)}if(aL.paginator.paging){R(H(aL,aM))}else{aL.data=aM}if(aL.summation.enable){ax(aL,aM)}if(aL.request.cache||!aL.remote){aL.Storage=aM}if(typeof aL.handler.onAsyncComplete=="function"){aL.handler.onAsyncComplete.call(null,aM)}}function G(aM){if(typeof aM.handler.onLoadComplete=="function"){var aP,aL,aO=aM.paginator;if(aM.request.loadonce){aP=aO.pageSize*(aO.pageIndex-1)+1;aL=Math.min(aO.records,aO.pageSize*aO.pageIndex)}else{aP=1;var aN=aO.pageIndex*aO.pageSize;if(aN>aO.records){aL=aO.records%aO.pageSize}else{aL=aO.pageSize}}aM.handler.onLoadComplete.call(null,aM.data.slice(0),aP,aL)}}function au(aL){aL.grid.find("thead .igrid-check input:checkbox, thead .igrid-radio input:radio").prop("checked",false);aL.grid.find("tbody").remove();aL.grid.find("thead").after(an(aL));G(aL)}function o(aL,aN){var aM=aL.Storage.where(function(aO){return aH(aO,aN,aL.cols)});aM=t(aM,aL.cols).sort(function(aO,aR){var aP=aL.request.sidx,aQ=aL.request.sord;if(typeof aQ=="string"){aQ=aQ=="ASC"?1:-1}return aQ>0?aO[aP]>aR[aP]:aO[aP]<aR[aP]});R(H(aL,aM));au(aL)}function aH(aR,aP,aT){if(at.isEmptyObject(aP)){return true}var aS=true;for(var aM in aP){var aU=aP[aM];if(aU){if(aM=="keyword"){var aQ=false;for(var aL in aR){var aO=aT.first(function(aV){return aV.field==aL});if(!aO||aO.hide){continue}aQ=aQ||(typeof aR[aL]=="string"&&aR[aL].contains(aU))}aS=aS&&aQ}else{if(!aR.hasOwnProperty(aM)){continue}var aN=aR[aM]||"";if(at.isArray(aU)){aS=aS&&aU.contains(aN.toString())}else{aS=aS&&(aN.toString()==aU)}}}}return aS}function w(aN,aM,aL){if(aN.request.cache){l(aN.Storage,aM,aL)}l(aN.data,aM,aL);if(typeof aN.handler.onUpdate=="function"){aN.handler.onUpdate.call(null,aN.Storage||aN.data)}}function l(aN,aM,aL){aN.forEach(function(aO){if(aM.call(null,aO)){for(var aP in aL){if(aO.hasOwnProperty(aP)){aO[aP]=aL[aP]}}}})}function f(aM){if(aM.request.loadonce){var aN=aM.paginator.pageSize*(aM.paginator.pageIndex-1);var aL=aM.paginator.pageSize*aM.paginator.pageIndex;aL=Math.min(aL,aM.paginator.records);return aM.data.slice(aN,aL)}else{return aM.data.slice(0)}}function M(aM,aN){var aL=V(aM,aN);return aM.data[aL]}function aJ(aN,aO,aM){var aL=V(aN,aO);return aN.data[aL][aM]}function ak(aM,aO,aN){var aL=V(aM,aO);aM.data[aL]=Y(aN,aM.cols)}function aD(aN,aP,aM,aO){var aL=V(aN,aP);if(O(aN.cols,aM)){aN.data[aL][aM]=aO}}function g(aM,aN){var aL=V(aM,aN);aM.data.splice(aL,1);H(aM)}function af(aM,aO,aN){var aL=V(aM,aO);if(!aM.data){aM.data=[]}aM.data.splice(aL,0,Y(aN,aM.cols));H(aM)}function F(aM,aL){aL.sort(function(aN,aO){return aO-aN}).forEach(function(aN){g(aM,aN)})}function b(aM,aO,aN){var aL=V(aM,aO);if(!aM.data){aM.data=aN}else{aN.forEach(function(aQ,aP){aM.data.splice(aL+aP,0,Y(aQ,aM.cols))})}H(aM)}function V(aM,aN){var aL=aM.request.loadonce?aN-1:(aN-1)%aM.paginator.pageSize;return Math.min(Math.max(aL,0),aM.data?aM.data.length:0)}function E(aL){if(aL.remote&&!aL.request.loadonce){aL.igrid.reload();return}var aN=aL.request.sidx,aO=aL.request.sord,aM=ao(aL.data,aO,aN);R(H(aL,aM));au(aL)}function ao(aM,aN,aL){return aM.sort(function(aO,aP){if(typeof aN=="string"){aN=aN=="ASC"?1:-1}return aN*(aO[aL]>aP[aL]?1:-1)})}function t(aO,aQ){for(var aN=0;aN<aO.length;aN++){for(var aP in aO[aN]){if(!O(aQ,aP)&&!at.isArray(aO[aN][aP])){delete aO[aN][aP]}}for(var aM=0;aM<aQ.length;aM++){var aL=aQ[aM];if(!aL.nondata&&!aO[aN].hasOwnProperty(aL.field)){if(aL.defaultVal!==undefined&&aL.defaultVal!==null){aO[aN][aL.field]=aL.defaultVal}else{aO[aN][aL.field]=""}}if(aL.format=="date"){aO[aN][aL.field]=I.formatDate(aO[aN][aL.field],aL.formatter)}}}return aO}function Y(aN,aM){for(var aL in aN){if(!O(aM,aL)&&!at.isArray(aN[aL])){delete aN[aL]}}return aN}function X(aL){if(window.Igrid){ap.Alert(aL,"error")}else{alert(aL)}}function U(aN){var aR="igrid-"+aN.guid+"-mask",aM=aN.root;var aQ=aM.next("#"+aR),aL=aM.outerHeight();var aP=I.toInt(aM.css("margin-top"))+I.toInt(aM.css("margin-bottom"));var aO="width:"+aM.outerWidth()+"px;height:"+(aL+aP)+"px;left:"+aM.position().left+"px;top:"+aM.position().top+"px;";if(aQ.length>0){aQ.show();aQ.attr("style",aO);return}aQ=at("<div id='"+aR+"' class='grid-mask'>").attr("style",aO);aM.after(aQ)}function c(aL){aL.root.next("#igrid-"+aL.guid+"-mask").hide()}function W(aL){return aL.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\f/g,"\\f")}var I={toInt:function(aN,aL){if(!aN){return 0}if(typeof aN=="string"&&aN.contains(",")){aN=aN.replace(",","")}var aM=parseInt(aN,10);return !aL&&isNaN(aM)?0:aM},toFloat:function(aN,aL){if(!aN){return 0}if(typeof aN=="string"&&aN.contains(",")){aN=aN.replace(",","")}var aM=parseFloat(aN);return !aL&&isNaN(aM)?0:aM},toMoney:function(aM,aL){return this.toFloat(aM).toFixed(aL||2)},formatDate:function(aM,aT){if(!aM){return""}if(typeof aM=="string"){if(aM.indexOf("0001")==0){return""}aM=aM.replace(/\-/g,"/").replace("T"," ").split(".")[0]}try{aM=new Date(aM)}catch(aO){throw aO}var aR=aM.getYear(),aU=aM.getFullYear(),aQ=aM.getMonth()+1,aS=aM.getDate(),aP=aM.getHours(),aN=aM.getMinutes(),aL=aM.getSeconds();var aV="";switch(aT){case"yyyy-MM-dd":aV=aU+"-"+(aQ>=10?aQ:"0"+aQ)+"-"+(aS>=10?aS:"0"+aS);break;case"yy-MM-dd":aV=aR+"-"+(aQ>=10?aQ:"0"+aQ)+"-"+(aS>=10?aS:"0"+aS);break;case"yyyy/MM/dd":aV=aU+"/"+(aQ>=10?aQ:"0"+aQ)+"/"+(aS>=10?aS:"0"+aS);break;case"yy/MM/dd":aV=aR+"/"+(aQ>=10?aQ:"0"+aQ)+"/"+(aS>=10?aS:"0"+aS);break;case"yyyy/MM/dd hh:mm:ss":aV=aU+"/"+(aQ>=10?aQ:"0"+aQ)+"/"+(aS>=10?aS:"0"+aS)+" "+(aP>=10?aP:"0"+aP)+":"+(aN>=10?aN:"0"+aN)+":"+(aL>=10?aL:"0"+aL);break;case"yy/MM/dd hh:mm:ss":aV=aR+"/"+(aQ>=10?aQ:"0"+aQ)+"/"+(aS>=10?aS:"0"+aS)+" "+(aP>=10?aP:"0"+aP)+":"+(aN>=10?aN:"0"+aN)+":"+(aL>=10?aL:"0"+aL);break;case"yy-MM-dd hh:mm:ss":aV=aR+"-"+(aQ>=10?aQ:"0"+aQ)+"-"+(aS>=10?aS:"0"+aS)+" "+(aP>=10?aP:"0"+aP)+":"+(aN>=10?aN:"0"+aN)+":"+(aL>=10?aL:"0"+aL);break;case"yyyy-MM-dd HH:mm:ss":default:aV=aU+"-"+(aQ>=10?aQ:"0"+aQ)+"-"+(aS>=10?aS:"0"+aS)+" "+(aP>=10?aP:"0"+aP)+":"+(aN>=10?aN:"0"+aN)+":"+(aL>=10?aL:"0"+aL);break}return aV}};var C={zh_CN:{unit:"条",total:"共{0}页，｛1｝条",current:"当前第｛0｝页",first:"首页",last:"尾页",prev:"上一页",next:"下一页",subtotal:"小计",summation:"合计"},en:{unit:"",total:"total {0} pages, {1} records",current:"page {0}",first:"first",last:"last",prev:"prev",next:"next",subtotal:"subtotal",summation:"summation"}};var D=function(aL,aM){return C[aM][aL]};if(!Array.prototype.select){Array.prototype.select=function(aN){var aO=0,aM=this.length,aL=[];if(aM==0){return aL}while(aO<aM){if(aO in this&&this[aO]){if(typeof aN=="string"&&this[aO].hasOwnProperty(aN)){aL.push(this[aO][aN])}else{if(typeof aN=="function"){aL.push(aN.call(this,this[aO],aO,this))}}}aO++}return aL}}if(!Array.prototype.sum){Array.prototype.sum=function(aO){var aM=0,aL=this.length,aN=0;if(aL==0){return aN}while(aM<aL){aN+=aO.call(this,this[aM],aM,this);aM++}return aN}}if(!Array.prototype.count){Array.prototype.count=function(aO){var aM=0,aL=this.length,aN=0;if(aL==0){return aN}while(aM<aL){if(aO.call(this,this[aM],aM,this)){aN++}aM++}return aN}}if(!Array.prototype.every){Array.prototype.every=function(aN){var aM=0,aL=this.length;if(aL==0){return true}while(aM<aL){if(aM in this&&!aN.call(this,this[aM],aM,this)){return false}aM++}return true}}if(!Array.prototype.all){Array.prototype.all=function(aN){var aM=0,aL=this.length;if(aL==0){return true}while(aM<aL){if(aM in this&&!aN.call(this,this[aM],aM,this)){return false}aM++}return true}}if(!Array.prototype.any){Array.prototype.any=function(aN){var aM=0,aL=this.length;if(aL==0){return false}while(aM<aL){if(aM in this&&aN.call(this,this[aM],aM,this)){return true}aM++}return false}}if(!Array.prototype.first){Array.prototype.first=function(aN){var aM=0,aL=this.length;if(aL==0){return null}while(aM<aL){if(aM in this&&aN.call(this,this[aM],aM,this)){return this[aM]}aM++}return null}}if(!Array.prototype.forEach){Array.prototype.forEach=function(aO){var aM=0,aL=this.length;if(aL==0){return}while(aM<aL){if(aM in this){var aN=this[aM];if(aO.call(this,aN,aM,this)===false){break}this[aM]=aN}aM++}}}if(!Array.prototype.where){Array.prototype.where=function(aO){var aN=0,aM=this.length,aL=[];if(aM==0){return aL}while(aN<aM){if(aN in this&&aO.call(this,this[aN],aN,this)){aL.push(this[aN])}aN++}return aL}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(aM){var aL=this.length>>>0,aN=Number(arguments[1])||0;aN=(aN<0)?Math.ceil(aN):Math.floor(aN);if(aN<0){aN+=aL}for(;aN<aL;aN++){if(aN in this&&this[aN]===aM){return aN}}return -1}}if(!Array.prototype.max){Array.prototype.max=function(aQ){var aP=1,aL=this.length,aO;if(aL==0){return null}aO=this[0];var aM=aQ&&typeof aQ=="function",aR,aN;while(aP<aL){aR=aM?aQ.call(this,aO,aP-1,this):aO;aN=aM?aQ.call(this,this[aP],aP,this):this[aP];if(aP in this&&aR<=aN){aO=this[aP]}aP++}return aO}}if(!Array.prototype.min){Array.prototype.min=function(aQ){var aP=1,aL=this.length,aO;if(aL==0){return null}aO=this[0];var aM=aQ&&typeof aQ=="function",aR,aN;while(aP<aL){aR=aM?aQ.call(this,aO,aP-1,this):aO;aN=aM?aQ.call(this,this[aP],aP,this):this[aP];if(aP in this&&aR>=aN){aO=this[aP]}aP++}return aO}}if(!Array.prototype.contains){Array.prototype.contains=function(aM){if(typeof aM!="function"){return this.indexOf(aM)>=0}var aN=0,aL=this.length;if(aL==0){return false}while(aN<aL){if(aN in this&&aM.call(this,this[aN],aN,this)){return true}aN++}return false}}if(!Array.prototype.remove){Array.prototype.remove=function(aO){var aL=this.length,aN=aL-1,aM=[];if(aL==0){return}while(aN>=0){if(aN in this&&aO.call(this,this[aN],aN,this)){aM.push(aN)}aN--}for(aN=0;aN<aM.length;aN++){this.splice(aM[aN],1)}}}if(!Array.prototype.distinct){Array.prototype.distinct=function(aN){var aM=this.length,aO=0,aL=[];if(aM==0){return aL}while(aO<aM){var aP=this[aO];if(aO in this&&aP){if(typeof aN=="string"&&aP.hasOwnProperty(aN)&&!aL.contains(function(aQ){return aQ[aN]==aP[aN]})){aL.push(aP)}else{if(typeof aN=="object"&&aN instanceof Array&&!aL.contains(function(aQ){return aN.all(function(aR){return aP.hasOwnProperty(aR)&&aQ[aR]==aP[aR]})})){aL.push(aP)}}}aO++}return aL}}if(!Array.prototype.equal){Array.prototype.equal=function(aN){if(!(aN instanceof Array)){return false}var aM=0,aL=this.length;if(aL!=aN.length){return false}while(aM<aL){if(this[aM]!=aN[aM]){return false}aM++}return true}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^(\s*)(\S+.*\S+)(\s*)$/,"$2")}}if(!String.prototype.trimLeft){String.prototype.trimLeft=function(){return this.replace(/^(\s*)(\S+.*)$/,"$2")}}if(!String.prototype.trimRight){String.prototype.trimRight=function(){return this.replace(/^(.*\S+)(\s*)$/,"$1")}}if(!String.prototype.contains){String.prototype.contains=function(aL){return this.indexOf(aL)>=0}}if(!String.prototype.startWith){String.prototype.startWith=function(aM,aL){return aL?this.toLowerCase().indexOf(aM.toLowerCase())==0:this.indexOf(aM)==0}}if(!String.prototype.format){String.prototype.format=function(){if(arguments.length==0){return this}var aM=arguments;var aL=this.replace(/\{(\d)\}/g,function(aO,aN){return aM[parseInt(aN,10)]});return aL}}if(!String.prototype.toSeparate){String.prototype.toSeparate=function(){var aO=this.indexOf("-")==0;var aQ=(aO?this.replace("-",""):this).split("."),aM=[];var aL=aQ[0].split("").reverse(),aN=aQ[1];for(var aP=0;aP<aL.length;aP++){aM.push(aL[aP]);if((aP+1)%3==0&&(aP+1<aL.length)){aM.push(",")}}return(aO?"-":"")+aM.reverse().join("")+(aN?"."+aN:"")}}if(!Number.prototype.toSeparate){Number.prototype.toSeparate=function(){return this.toString(10).toSeparate()}}})(jQuery);