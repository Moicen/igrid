!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function f(){var c,a=b++;do c=(0|65536*(1+Math.random())).toString(16);while(d[c+a]);return c+a}function g(b,c){var h,i,g=f();a(b).data("guid",g),h=a("<div class='igrid igrid-panel'>").insertBefore(b).append(b),i=a("<div class='igrid igrid-root'>").insertBefore(h).append(h),d[g]=a.extend(!0,{guid:g,grid:b,root:i,panel:h,igrid:this},e,c),k(d[g]),this.guid=g}function h(){var a=sessionStorage.igridStatus;return a&&(a=JSON.parse(a)),a}function i(a){var b;return a&&a.indexOf("/")<=0&&(b=location.pathname.split("/"),b.splice(b.length-1,1,a),b=b.join("/")),b||a}function j(a,b){for(var c=0;c<a.length;c++)if(a[c].field==b)return!0;return!1}function k(a){a.isWebKit=navigator.userAgent.toLowerCase().contains("webkit"),a=m(a),a.width&&a.root.width(a.width),a.height&&a.grid.parent().height(a.height),a.head.enable&&u(a),a.paginator.paging?U(V(a)):a.paginator.pageSize=1/0,l(a),C(a),n(a)}function l(a){var b,d,e;if(!c){c={},b=a.icons.prefix,c.prefix=b;for(d in a.icons)"prefix"!=d&&(e=a.icons[d].split(" "),c[d]=e.select(function(a){return b+"-"+a}).join(" "))}}function m(a){if(!a)throw Error("init options undefined!");if(0==a.cols.length)throw Error("cols has no element!");if(a.singleSelect&&a.multiSelect)throw Error("singleSelect and multiSelect can not be true at the same time!");isNaN(parseInt(a.request.sord,10))&&(a.request.sord=1),a.request.sidx&&j(a.cols,a.request.sidx)||(a.request.sidx=a.cols[0].field),(isNaN(parseInt(a.paginator.pageIndex))||a.paginator.pageIndex<=0)&&(a.paginator.pageIndex=1);var b=h();return b&&b.url==i(a.request.url)&&(a.paginator.pageIndex=b.page,a.paginator.selectedRow=b.row,a.request.param=b.param,sessionStorage.removeItem("igridStatus")),a}function n(a){p(a),o(a),w(a)}function o(b){b.grid.on("click","tbody td",function(){var c,d,e,f,g;a(this).parent().hasClass("igrid-sub-tr")||(c=a(this).parent(),d=parseInt(c.attr("data-ridx"),10),e=b.igrid.getRowData(d),b.multiSelect?(f=c.find(".igrid-check input:checkbox"),g=!f.prop("checked"),f.prop("checked",g),c.toggleClass("selected",g),q(b,g,e,d)):c.hasClass("selected")?(c.removeClass("selected"),b.singleSelect&&(c.find(".igrid-radio input:radio").prop("checked",!1),q(b,!1,e,d))):(c.parent().find("tr.selected").removeClass("selected"),c.addClass("selected"),b.singleSelect&&(c.parent().find("tr.selected").find(".igrid-radio input:radio").prop("checked",!0),q(b,!0,e,d))),"function"==typeof b.handler.onCellClick&&b.handler.onCellClick.call(null,d,c.hasClass("selected")))}),b.grid.on("click","tbody td input:radio",function(c){var d=a(this).parent().parent(),e=parseInt(d.attr("data-ridx"),10),f=b.igrid.getRowData(e);d.hasClass("selected")?q(b,!1,f,e):(d.parent().find("tr.selected").removeClass("selected"),d.addClass("selected"),q(b,!0,f,e)),c.stopPropagation()}),b.grid.on("click","tbody td input:checkbox",function(c){var d=a(this).parent().parent(),e=a(this).prop("checked"),f=parseInt(d.attr("data-ridx"),10),g=b.igrid.getRowData(f);d.toggleClass("selected",e),q(b,e,g,f),c.stopPropagation()}),b.grid.on("click","tbody td.igrid-sub-icon",function(){var g,d=a(this).parent(),e=d.next("tr.igrid-sub-tr"),f=a(this).index();if(d.hasClass("open"))d.removeClass("open"),a(this).find("i").removeClass(c.minus).addClass(c.plus),e.hide();else{if(d.addClass("open"),a(this).find("i").removeClass(c.plus).addClass(c.minus),e.length>0)return e.show(),void 0;e=a("<tr class='igrid-sub-tr'></tr>"),g="<td><i class='{0} {1}'></i></td>".format(c.prefix,c.sub),e.append(0==f?g:"<td colspan='"+f+"'></td>"+g),t(d,e,b)}}),b.grid.find("thead th.sortable").click(function(){a(this).parent().find("th.sortable").not(this).find("i").removeClass(c.sortAsc+" "+c.sortDesc).addClass(c.sort).css({color:""});var d=a(this).find("i");d.hasClass(c.sortAsc)?(d.removeClass(c.sortAsc).addClass(c.sortDesc),b.request.sord=-1):(d.removeClass(c.sort+" "+c.sortDesc).addClass(c.sortAsc),b.request.sord=1),b.request.sidx=a(this).data("sortfield"),xb(b)}),b.grid.on("click",".editable input, .editable select, .editable checkbox",function(b){var c=a(this).parent().parent();c.hasClass("selected")||(c.parent().find("tr.selected").removeClass("selected"),c.addClass("selected")),b.stopPropagation()}),b.grid.find("thead .igrid-check input:checkbox").click(function(){var c=a(this).prop("checked");b.grid.find("tbody .igrid-check input:checkbox").prop("checked",c),b.grid.find("tbody  tr").toggleClass("selected",c),r(b,c)}),b.grid.find("thead .igrid-radio input:radio").click(function(){b.grid.find("tbody .igrid-radio input:radio").prop("checked",!1),b.grid.find("tbody  tr").removeClass("selected")}),"function"==typeof b.handler.onCellDblClick&&b.grid.on("dblclick","tbody td",function(){var c=a(this).parent(),d=parseInt(c.attr("data-ridx"),10),e=b.igrid.getRowData(d);b.handler.onCellDblClick.call(null,e,d)}),b.grid.on("click","thead th.igrid-header-control",function(){var d=b.root.find(".igrid-header");d.is(":visible")?(d.hide("slide"),a(this).find("i").removeClass().addClass(c.prefix+" "+c.popup)):(d.show("slide"),a(this).find("i").removeClass().addClass(c.prefix+" "+c.recoil))})}function p(b){b.root.on("click",".igrid-header input:checkbox",function(){v(b,this.value,a(this).prop("checked"))})}function q(a,b,c,d){b?"function"==typeof a.handler.onSelectRow&&a.handler.onSelectRow.call(null,c,d):"function"==typeof a.handler.onDeSelectRow&&a.handler.onDeSelectRow.call(null,c,d)}function r(a,b){b?a.handler.onSelectAll&&"function"==typeof a.handler.onSelectAll&&a.handler.onSelectAll.call(null,nb(a)):a.handler.onDeSelectAll&&"function"==typeof a.handler.onDeSelectAll&&a.handler.onDeSelectAll.call(null,nb(a))}function s(a,b){var c=[],d=0;return b.forEach(function(a,b){if(!a.cols)throw Error("subgrid options requires cols !");d+=c[b]=a.cols.count(function(a){return!a.hide})}),c.select(function(b){return Math.floor(b/d*a)})}function t(b,c,d){var e,f;a.isArray(d.subGrid.options)||(d.subGrid.options=[d.subGrid.options]),e=s(d.cols.count(function(a){return!a.hide}),d.subGrid.options),f=[],d.subGrid.options.forEach(function(g,h){var l,i=a("<table></table>").addClass(d.grid.attr("class")),j=parseInt(b.attr("data-ridx"),10),k=d.igrid.getRowData(j);"function"==typeof g.data&&(g.data=g.data.call(null,k)),"function"==typeof g.paramFn&&(g.request.param=g.paramFn.call(null,k,j)),l=a("<td colspan='{0}' data-idx='{1}'></td>".format(e[h],h)),c.append(l.append(i)),f.push({grid:i,opt:g})}),b.after(c),f.forEach(function(a){a.grid.igrid(a.opt)})}function u(a){var b="<div class='igrid igrid-header'>{0}</div>",c="<div class='input-group'><span class='input-group-addon'><strong>显示以下列</strong></span>";c+="<div class='checkbox-group multiple-line-group'>",a.cols.forEach(function(a){a.fixed||(c+="<label class='checkbox-inline'>"+"<input type='checkbox' value='{0}' {1} />".format(a.field,a.hide?"":" checked='checked'")+a.label+"</label>")}),c+="</div></div>",a.panel.before(b.format(c))}function v(b,c,d){var g,e=b.grid,f=b.cols;if("string"==typeof c&&(c=c.split(",")),!a.isArray(c))throw new Error("col must be an array of string or a string!");d?c.forEach(function(a){f.first(function(b){return b.field==a}).hide=!1,e.find("th[data-field='"+a+"'], td[data-field='"+a+"']").removeClass("hide")}):c.forEach(function(a){f.first(function(b){return b.field==a}).hide=!0,e.find("th[data-field='"+a+"'], td[data-field='"+a+"']").addClass("hide")}),b.subGrid.enable&&(g=s(f.count(function(a){return!a.hide}),b.subGrid.options),e.find("tr.igrid-sub-tr td[data-idx]").each(function(){a(this).attr("colspan",g[a(this).data("idx")])})),e.find("tr.subtotal").html(K(b,"subtotal","小计")),e.find("tr.sum").html(K(b,"data","总计"))}function w(b){b.grid.on("blur","[contenteditable='true']",function(){var h,c=b.isWebKit?a(this):a(this).parent(),d=c.parent(),e=c.data("field"),f=parseInt(d.attr("data-ridx"),10),g=b.cols.first(function(a){return a.field==e});g.edit&&g.edit.enable&&(h=x(a(this),f,e,b),a(this).html(P(h,g,f,b.igrid.getRowData(f))))}),b.grid.on("keydown","[contenteditable='true']",function(c){var d,e,f,g;c.shiftKey||c.ctrlKey||(d=b.isWebKit?a(this):a(this).parent(),e=c.which||c.code,f=d.data("index"),g=null,37==e&&(g=d.prev("td.editable")),39==e&&(g=d.next("td.editable")),40==e&&(g=d.parent().next("tr").find("td[data-index='"+f+"'].editable")),38==e&&(g=d.parent().prev("tr").find("td[data-index='"+f+"'].editable")),g&&g.length>0&&(g=b.isWebKit?g:g.find("[contenteditable='true']"),g.focus()))})}function x(a,b,c,d){var e,f;return a.children().length>0&&a.html(a.children()[0].innerHTML),e=d.cols.first(function(a){return a.field==c}),f=y(e,c,a.html()),a.html(f||a.html()),"function"==typeof d.handler.beforeCellSave&&(f=d.handler.beforeCellSave.call(null,f,c,b)),f===!1?(A(a),!1):(z(d,wb(d,b),c,f),"function"==typeof d.handler.afterCellSave&&d.handler.afterCellSave.call(null,f,c,b),B(a),P(f,e,b,ob(d,b)))}function y(a,b,c){var d,e;if(!a.edit)return c;if(d=c,"integer"==a.edit.type&&(d=Fb.toInt(d,!0),c&&isNaN(d)))return Bb("please input a integer"),!1;if("decimal"==a.edit.type&&(d=Fb.toFloat(d,!0),c&&isNaN(d)))return Bb("please input a number"),!1;if(e=a.edit.rules){if(e.hasOwnProperty("min")&&d<e.min)return Bb("{0}c annot be less then {1}".format(a.label,e.min)),!1;if(e.hasOwnProperty("max")&&d>e.max)return Bb("{0} cannot be greeter then {1}".format(a.label,e.max)),!1}return d}function z(a,b,c,d){a.data[b][c]=d}function A(a){a.addClass("input-error")}function B(a){a.removeClass("input-error")}function C(a){a.caption&&a.grid.append("<caption>"+a.caption+"</caption>"),E(a),D(a)}function D(a){!a.remote||a.data&&0!=a.data.length?(gb(a),a.grid.append(G(a)),hb(a)):eb(a)}function E(a){if(0==a.cols.length)throw Error("cols has no element!");var b="<thead><tr>",d=a.head.enable,e=d?"<i class='{0} {1}'></i>".format(c.prefix,c.popup):"";a.showRowNum&&(b+="<th class='ridx {0}'>".format(d?"igrid-header-control":""),d&&(b+=e),b+="</th>"),a.singleSelect&&(b+="<th class='igrid-radio'><input type='radio' value='none' /></th>"),a.multiSelect&&(b+="<th class='igrid-check'><input type='checkbox' value='all' /></th>"),a.subGrid.enable&&(b+="<th class='igrid-sub-icon'></th>"),b+=F(a),a.customCol&&(b+=("<th {0}>"+a.customCol.label+"</th>").format(a.customCol.width?"style='width:{0}px;'".format(a.customCol.width):"")),b+="</tr></thead>",a.grid.append(b)}function F(a){var d,e,f,g,h,i,j,k,b="";for(d=0;d<a.cols.length;d++)e=a.cols[d],f="",g="",h="",i=e.label,j="<th data-field='{0}' class='{1}' style='{2}' {3}>{4}</th>",e.hide&&(g+=" hide "),e.width&&(f+="width:"+e.width+"px;"),e.sortable&&(g+=" sortable ",h+="data-sortfield='"+(e.sortfield||e.field)+"'",k=a.request.sidx==e.field?a.request.sord>0?c.sortAsc:c.sortDesc:c.sort,i+="<i class='{0} {1}'></i>".format(c.prefix,k)),b+=j.format(e.field,g,f,h,i);return b}function G(b){var f,g,h,c=a("<tbody>"),d=b.data,e=b.request.loadonce?b.paginator.pageSize*(b.paginator.pageIndex-1)+1:1;if(b.request.loadonce&&(b.paginator.records>b.paginator.pageSize?(f=e-1,g=b.paginator.pageSize*b.paginator.pageIndex,d=d.slice(f,Math.min(g,b.paginator.records))):e=1),a.isArray(d)&&d.length>0)for(h=0;h<d.length;h++)c.append(H(b,e++,d[h]));return b.summation.enable&&(T(b,d),c.append(I(b)+J(b))),c}function H(b,d,e){var g,f=a("<tr>").attr("data-ridx",d);for(b.showRowNum&&f.append(a("<td class='ridx'>").text(R(b,d))),b.singleSelect&&f.append("<td class='igrid-radio'><input type='radio' value='"+d+"' /></td>"),b.multiSelect&&f.append("<td class='igrid-check'><input type='checkbox' value='"+d+"' /></td>"),b.subGrid.enable&&f.append("<td class='igrid-sub-icon'><i class='{0} {1}'></i></td>".format(c.prefix,c.plus)),g=0;g<b.cols.length;g++)f.append(L(b.cols[g],d,e,b.isWebKit));return b.customCol&&f.append(M(b.customCol,d,e)),b.paginator.selectedRow==d&&(f.addClass("selected"),f.find(".igrid-radio input:radio, .igrid-check input:checkbox").prop("checked",!0),delete b.paginator.selectedRow),f}function I(a){return"<tr class='subtotal'>{0}</tr>".format(K(a,"subtotal","小计"))}function J(a){return"<tr class='sum'>{0}</tr>".format(K(a,"data","总计"))}function K(a,b,c){var i,j,k,d="",e=null,f=0,h=a.cols.length;if(!a.summation[b])return null;for(a.showRowNum&&f++,a.singleSelect&&f++,a.multiSelect&&f++,a.subGrid.enable&&f++,i=0;h>i;i++)j=a.cols[i],j.hide||(f++,j.sum?(e||(e="<td colspan='{0}'>{1}：</td>".format(f-1,c),d+=e),k=a.summation[b][j.field],"separate"==j.format?k=k.toSeparate():"money"==j.format&&(k=g.ToDecimalString(k).toSeparate()),d+="<td class='{0}'>{1}</td>".format(j.align,k)):e&&(d+="<td></td>"));return d}function L(b,c,d,e){var f=a("<td>").attr("data-field",b.field),g=d[b.field],h=P(g,b,c,d);return b.highlight&&Q(f,g,b.highlight,c,d),N(f,h,b,e),f}function M(b,c,d){var f,e=a("<td>");return f="function"==typeof b.content?b.content.call(null,c,d):b.content,a.isArray(f)?f.forEach(function(a){e.append(a)}):e.html(null===f||void 0===f?"":f),e}function N(b,c,d,e){"img"==d.format&&b.addClass("img"),d.hide&&b.addClass("hide"),d.align&&b.addClass(d.align),a.isArray(c)?c.forEach(function(a){b.append(a)}):b.append(c),d.edit&&d.edit.enable&&O(b,e)}function O(a,b){a.addClass("editable");var c=a.html();b?a.prop("contenteditable",!0).focus():(a.html("<div contenteditable='true'>{0}</div>".format(c)),a.find("div[contenteditable]").focus())}function P(b,c,d,e){switch(c.format){case"separate":return"function"==typeof c.formatter?c.formatter.call(null,b,e,d):b.toSeparate();case"money":return"function"==typeof c.formatter?c.formatter.call(null,b,e,d):Fb.toMoney(b).toSeparate();case"select":if("object"!=typeof c.formatter)throw Error("The formatter for select must be object!");return c.formatter[b];case"checkbox":return"<input type='checkbox' disabled='disabled' {0} />".format(b?"checked='checked'":"");case"date":return Fb.formatDate(b,c.formatter);case"link":var f;if("string"==typeof c.formatter)f=c.formatter;else{if("function"!=typeof c.formatter)throw Error("The formatter for link must be a string or a function which return a string !");f=c.formatter.call(null,b,e,d)}return!f||f instanceof a||/^<\s*(\S+)(\s[^>]*)?>[\s\S]*<\s*\/\1\s*>$/.test(f)||(f="<a href='"+f+"' data-ridx='"+d+"'>"+b+"</a>"),f;case"img":return c.formatter.call(null,e);case"custom":return"function"==typeof c.formatter&&(b=c.formatter.call(null,b,e,d)),b;case"percent":return b="function"==typeof c.formatter?c.formatter.call(null,b,e,d):parseFloat(c.formatter?100*b:b).toFixed(2)+"%";default:return"function"==typeof c.formatter&&(b=c.formatter.call(null,b,e,d)),"string"==typeof b&&(b=b.replace(/[\b\f\n\r\t\v]/g," ")),void 0===b||null===b?"":b}}function Q(a,b,c,d,e){var f="red";if(c&&"object"==typeof c){if(c.factor&&"function"!=typeof c.factor)throw Error("factor of highlight must be a function!");if("function"==typeof c.factor&&!c.factor.call(null,b,e,d))return;f=c.color||f,"function"==typeof f&&(f=f.call(null,b,e,d))}a.css("color",f)}function R(a,b){return a.request.loadonce?b:a.paginator.pageSize*(a.paginator.pageIndex-1)+b}function S(a,b){if(!a.request.loadonce&&b.summation)return a.summation.data=b.summation,void 0;if(a.request.loadonce){var c={};a.cols.forEach(function(b){b.sum&&(c[b.field]=a.data.sum(function(a){return Fb.toFloat(a[b.field])}))}),a.summation.data=c}}function T(a,b){var c={};a.cols.forEach(function(a){a.sum&&(c[a.field]=b.sum(function(b){return Fb.toFloat(b[a.field])}))}),a.summation.subtotal=c}function U(a){a&&(X(a),$(a))}function V(a,b){if(!a.paginator.paging)return!1;if(a.paginator.pageSizeList.contains(a.paginator.pageSize)||(a.paginator.pageSize=a.paginator.pageSizeList[0]),b=b||a.data,a.request.loadonce){if(b){a.paginator.records=b.length;var c=a.paginator.records%a.paginator.pageSize;a.paginator.pageCount=0==c?a.paginator.records/a.paginator.pageSize:Math.floor(a.paginator.records/a.paginator.pageSize)+1,a.paginator.pageIndex=Math.max(Math.min(a.paginator.pageIndex,a.paginator.pageCount),1)}}else b&&(a.paginator.records=b.records||0,a.paginator.pageCount=b.pageCount||0,b=b.list||[]);return a.data=b,a}function W(a){a&&(a.root.find(".igrid-paginator").remove(),U(a))}function X(a){var b=Y(a.paginator,a.lang),c=Z(a.paginator,a.lang),d="<div class='igrid igrid-paginator clearfix'>{0}</div>".format(b+c);a.root.append(d)}function Y(a,b){return"<div class='igrid-paginator-left'>"+ab(a.pageSizeList,a.pageSize,b)+"</div>"}function Z(a,b){return"<div class='igrid-paginator-right'>{0}{1}{2}</div>".format(bb(a,b),cb(a,b),db(a,b))}function $(b){b.root.find(".igrid-paginator .page-size").change(function(){b.paginator.pageSize=parseInt(a(this).val(),10),_(b,1)}),b.root.find(".igrid-paginator .page-number").keydown(function(a){if(13==a.which||13==a.keyCode){var c=parseInt(this.innerHTML,10);isNaN(c)&&(c=1),_(b,c)}}),b.root.find(".igrid-paginator .page-number-btn").click(function(){var a=parseInt(b.root.find(".igrid-paginator .page-number").html(),10);isNaN(a)&&(a=1),_(b,a)}),b.root.find(".igrid-paginator a[data-page-number]").not(".disabled").click(function(){var d,c=a(this).data("page-number");switch(c){case"first":d=1;break;case"prev":d=b.paginator.pageIndex-1;break;case"next":d=b.paginator.pageIndex+1;break;case"last":d=b.paginator.pageCount;break;default:d=parseInt(c,10)}d!=b.paginator.pageIndex&&_(b,d)})}function _(a,b){a.paginator.pageIndex=Math.min(Math.max(1,b),a.paginator.pageCount),a.request.loadonce?(ib(a),W(V(a))):eb(a)}function ab(a,b,c){var d="<select class='page-size'>";return a.forEach(function(a){d+="<option value='{0}' {1} >{0}</option>".format(a+Hb("unit",c),a==b?"selected='selected'":"")}),d+="</select>"}function bb(a,b){return"<span class='static-control'>{0},{1}</span>".format(Hb("total",b).format("<strong>"+a.pageCount+"</strong>","<strong>"+a.records+"</strong>"),Hb("current",b).format("<strong>"+a.pageIndex+"</strong>"))}function cb(a,b){var d,e,f,g,c="<span class='pagination'>";return a.pageCount>0&&(d="<a href='javascript:void(0);' data-page-number='first' {0}>"+Hb("first",b)+"</a>",e="<a href='javascript:void(0);' data-page-number='prev' {0}>"+Hb("prev",b)+"</a>",c+=(d+e).format(1==a.pageIndex?"class='disabled'":""),f="<a href='javascript:void(0);' data-page-number='next' {0}>"+Hb("next",b)+"</a>",g="<a href='javascript:void(0);' data-page-number='last' {0}>"+Hb("last",b)+"</a>",c+=(f+g).format(a.pageIndex==a.pageCount?"class='disabled'":"")),c+"</span>"}function db(a){var c="<span contenteditable='true' class='page-number'>"+a.pageIndex+"</span><button type='button' class='page-number-btn btn'>GO</button>";return c}function eb(b){Cb(b);var c=a.extend(b.request.param,{sord:b.request.sord,sidx:b.request.sidx||b.cols[0].field});b.paginator.paging&&!b.request.loadonce&&(c.pageIndex=b.paginator.pageIndex,c.pageSize=b.paginator.pageSize),a.ajax({url:b.request.url,data:c,type:b.request.mtype,contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"json"}).done(function(a){return a=fb(a),a.Error?(Bb(a.Message),void 0):(gb(b,a),ib(b),void 0)}).fail(function(a){var b=a.responseJSON;Bb(b?b.Message:"请求失败！")}).always(function(){Db(b)})}function fb(a){if("string"==typeof a)try{a=JSON.parse(a)}catch(b){try{a=JSON.parse(Eb(a))}catch(c){throw Error("An error occured when data was parsed to json.")}}return a||[]}function gb(a,b){b=b||a.data,b.list?b.list=zb(b.list,a.cols):b=yb(zb(b,a.cols),a.request.sord,a.request.sidx),a.paginator.paging?W(V(a,b)):a.data=b,a.summation.enable&&S(a,b),(a.request.cache||!a.remote)&&(a.Storage=b),"function"==typeof a.handler.onAsyncComplete&&a.handler.onAsyncComplete.call(null,b)}function hb(a){var b,c,d,e;"function"==typeof a.handler.onLoadComplete&&(d=a.paginator,a.request.loadonce?(b=d.pageSize*(d.pageIndex-1)+1,c=Math.min(d.records,d.pageSize*d.pageIndex)):(b=1,e=d.pageIndex*d.pageSize,c=e>d.records?d.records%d.pageSize:d.pageSize),a.handler.onLoadComplete.call(null,a.data.slice(0),b,c))}function ib(a){a.grid.find("thead .igrid-check input:checkbox, thead .igrid-radio input:radio").prop("checked",!1),a.grid.find("tbody").remove(),a.grid.find("thead").after(G(a)),hb(a)}function jb(a,b){var c=a.Storage.where(function(c){return kb(c,b,a.cols)});c=zb(c,a.cols).sort(function(b,c){var d=a.request.sidx,e=a.request.sord;return"string"==typeof e&&(e="ASC"==e?1:-1),e>0?b[d]>c[d]:b[d]<c[d]}),W(V(a,c)),ib(a)}function kb(b,c,d){var e,f,g,h,i,j,k;if(a.isEmptyObject(c))return!0;e=!0;for(f in c)if(g=c[f])if("keyword"==f){h=!1;for(i in b)j=d.first(function(a){return a.field==i}),j&&!j.hide&&(h=h||"string"==typeof b[i]&&b[i].contains(g));e=e&&h}else{if(!b.hasOwnProperty(f))continue;k=b[f]||"",e=a.isArray(g)?e&&g.contains(k.toString()):e&&k.toString()==g}return e}function lb(a,b,c){a.request.cache&&mb(a.Storage,b,c),mb(a.data,b,c),"function"==typeof a.handler.onUpdate&&a.handler.onUpdate.call(null,a.Storage||a.data)}function mb(a,b,c){a.forEach(function(a){if(b.call(null,a))for(var d in c)a.hasOwnProperty(d)&&(a[d]=c[d])})}function nb(a){var b,c;return a.request.loadonce?(b=a.paginator.pageSize*(a.paginator.pageIndex-1),c=a.paginator.pageSize*a.paginator.pageIndex,c=Math.min(c,a.paginator.records),a.data.slice(b,c)):a.data.slice(0)}function ob(a,b){var c=wb(a,b);return a.data[c]}function pb(a,b,c){var d=wb(a,b);return a.data[d][c]}function qb(a,b,c){var d=wb(a,b);a.data[d]=Ab(c,a.cols)}function rb(a,b,c,d){var e=wb(a,b);j(a.cols,c)&&(a.data[e][c]=d)}function sb(a,b){var c=wb(a,b);a.data.splice(c,1),V(a)}function tb(a,b,c){var d=wb(a,b);a.data||(a.data=[]),a.data.splice(d,0,Ab(c,a.cols)),V(a)}function ub(a,b){b.sort(function(a,b){return b-a}).forEach(function(b){sb(a,b)})}function vb(a,b,c){var d=wb(a,b);a.data?c.forEach(function(b,c){a.data.splice(d+c,0,Ab(b,a.cols))}):a.data=c,V(a)}function wb(a,b){var c=a.request.loadonce?b-1:(b-1)%a.paginator.pageSize;return Math.min(Math.max(c,0),a.data?a.data.length:0)}function xb(a){if(a.remote&&!a.request.loadonce)return a.igrid.reload(),void 0;var b=a.request.sidx,c=a.request.sord,d=yb(a.data,c,b);W(V(a,d)),ib(a)}function yb(a,b,c){return a.sort(function(a,d){return"string"==typeof b&&(b="ASC"==b?1:-1),b*(a[c]>d[c]?1:-1)})}function zb(b,c){var d,e,f,g;for(d=0;d<b.length;d++){for(e in b[d])j(c,e)||a.isArray(b[d][e])||delete b[d][e];for(f=0;f<c.length;f++)g=c[f],g.nondata||b[d].hasOwnProperty(g.field)||(b[d][g.field]=void 0!==g.defaultVal&&null!==g.defaultVal?g.defaultVal:""),"date"==g.format&&(b[d][g.field]=Fb.formatDate(b[d][g.field],g.formatter))}return b}function Ab(b,c){for(var d in b)j(c,d)||a.isArray(b[d])||delete b[d];return b}function Bb(a){window.Igrid?g.Alert(a,"error"):alert(a)}function Cb(b){var c="igrid-"+b.guid+"-mask",d=b.root,e=d.next("#"+c),f=d.outerHeight(),g=Fb.toInt(d.css("margin-top"))+Fb.toInt(d.css("margin-bottom")),h="width:"+d.outerWidth()+"px;height:"+(f+g)+"px;left:"+d.position().left+"px;top:"+d.position().top+"px;";return e.length>0?(e.show(),e.attr("style",h),void 0):(e=a("<div id='"+c+"' class='grid-mask'>").attr("style",h),d.after(e),void 0)}function Db(a){a.root.next("#igrid-"+a.guid+"-mask").hide()}function Eb(a){return a.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\f/g,"\\f")}var b,c,d,e,Fb,Gb,Hb;a.fn.igrid=function(b){if(!a(this).is("table"))throw Error("Igrid element must be a table!");var c=a(this).data("guid");return d[c]?d[c].igrid:new g(this,b)},b=0,c=null,d={},e={cols:[],customCol:void 0,singleSelect:!1,multiSelect:!1,showRowNum:!0,data:[],remote:!0,head:{enable:!1},request:{cache:!1,loadonce:!0,param:{},sord:1,sidx:void 0,url:void 0,mtype:"POST"},summation:{enable:!1,data:null},paginator:{paging:!0,pageSizeList:[10,20,50],pageSize:10,pageIndex:1,records:0,pageCount:0},lang:"en",handler:{},icons:{prefix:"fa",sort:"sort",sortAsc:"sort-asc",sortDesc:"sort-desc",plus:"plus",minus:"minus",popup:"angle-double-up",recoil:"angle-double-down",sub:"level-up rotate-90"},subGrid:{enable:!1,options:null}},g.prototype={version:"1.0.0",constructor:g,getOption:function(a){return void 0===a?d[this.guid]:d[this.guid][a]},load:function(b){var c=d[this.guid];return b&&a.isArray(b)&&(c.data=zb(b,c.cols)),c.paginator.paging&&W(V(c)),ib(c),c.igrid},reload:function(b){var c=d[this.guid];return b&&(c.paginator.pageIndex=1),a.isArray(b)?(c.data=zb(b,c.cols),d[this.guid].paginator.paging&&W(V(c)),ib(c)):c.remote&&("object"==typeof b&&(c.request.param=b),eb(c)),c.igrid},search:function(a){var b=d[this.guid];return!b.request.cache&&b.remote?this.reload(a):(jb(b,a),b.igrid)},update:function(a,b){var c=d[this.guid];return c.request.loadonce?(lb(c,a,b),this.refresh(),c.igrid):c.igrid},clear:function(){var a=d[this.guid];return a.data=[],W(V(a)),ib(a),a.igrid},refresh:function(){return ib(d[this.guid]),d[this.guid].igrid},showCol:function(a){var b=d[this.guid];return v(b.grid,a,!0),b.igrid},hideCol:function(a){var b=d[this.guid];return v(b.grid,a,!1),b.igrid},toggleCol:function(a,b){var c=d[this.guid];return v(c.grid,a,b),c.igrid},addRowData:function(b,c){var f,g,h,e=d[this.guid];if(e.remote&&!e.request.loadonce)throw Error("Remote data cannot be added here!");if(f=e.data?e.data.length:0,c||"object"!=typeof b||(c=b,b=f+1),a.isEmptyObject(c))throw Error("The argument 'data' is empty.");return b=Math.min(Math.max(b,1),f+1),tb(e,b,c),e.paginator.paging?(g=e.paginator.pageIndex,h=e.paginator.pageSize*e.paginator.pageIndex,b>h&&(g=Math.ceil(b/e.paginator.pageSize),g>e.paginator.pageCount&&e.paginator.pageCount++),_(e,g),e.igrid):(ib(e),e.igrid)},addMultiRowDatas:function(b,c){var f,g,h,e=d[this.guid];if(!e.request.loadonce)throw Error("Remote data cannot be added here!");if(f=d[this.guid].data?d[this.guid].data.length:0,c||"object"!=typeof b||(c=b,b=f+1),!a.isArray(c))throw Error("The argument 'rows' must be an array.");return b=Math.min(Math.max(b,1),f+1),vb(e,b,c),e.paginator.paging?(g=e.paginator.pageIndex,h=e.paginator.pageSize*e.paginator.pageIndex,b+=c.length-1,b>h&&(g=Math.ceil(b/e.paginator.pageSize),g>e.paginator.pageCount&&e.paginator.pageCount++),_(e,g),e.igrid):(ib(e),e.igrid)},setRowData:function(b,c){var e,f;if(!c||a.isEmptyObject(c))throw Error("The argument 'data' is empty.");if(e=d[this.guid],f=e.grid.find("tr[data-ridx='"+b+"']"),0==f.length)throw Error("Row index out of range.");return qb(e,b,c),ib(e),e.igrid},getRowData:function(a){return ob(d[this.guid],a)},delRowData:function(a){var b=d[this.guid];if(a>b.data.length||0>a)throw new Error("ridx is out of range.");return sb(b,a),b.paginator.paging?(_(b,b.paginator.pageIndex),b.igrid):(ib(b),b.igrid)},delMultiRowDatas:function(b){var c=d[this.guid];if(!a.isArray(b))throw Error("The argument 'ridxes' must be an array.");return 0==b.length?c.igrid:(ub(c,b),c.paginator.paging?(_(c,c.paginator.pageIndex),c.igrid):(ib(c),c.igrid))},getSelectedRow:function(){var a=d[this.guid].grid.find("tr.selected");return 0==a.length?null:ob(d[this.guid],parseInt(a.attr("data-ridx"),10))},getSelectedRowIdx:function(){var a=d[this.guid].grid.find("tr.selected");return 0==a.length?void 0:parseInt(a.attr("data-ridx"),10)},setSelectedRowData:function(a){var c,b=d[this.guid].grid.find("tr.selected");if(0==b.length)throw Error("No row selected.");return c=parseInt(b.attr("data-ridx"),10),this.setRowData(c,a)},delSelctedRow:function(){var b=d[this.guid].grid,c=b.find("tr.selected");if(0==c.length)throw Error("No row selected.");return c.each(function(){var c=parseInt(a(this).attr("data-ridx"),10);a(this).remove(),b.find("tr[data-ridx]").each(function(){var b=parseInt(a(this).attr("data-ridx"),10);b>c&&(a(this).attr("data-ridx",b-1),a(this).find("td.ridx").text(b-1))}),sb(d[this.guid],c)}),d[this.guid].igrid},getMultiSelectedRows:function(){var c,e,b=d[this.guid].grid.find("tr.selected").not(".sum");if(0==b.length)return null;for(c=[],e=0;e<b.length;e++)c.push(ob(d[this.guid],parseInt(a(b[e]).attr("data-ridx"),10)));return c},getMultiSelectedRowIdxes:function(){var e,b=d[this.guid].grid.find("tr.selected").not(".sum"),c=[];for(e=0;e<b.length;e++)c.push(parseInt(a(b[e]).attr("data-ridx"),10));return c},setRowSelected:function(a){var e,b=d[this.guid],c=b.grid.find("tr[data-ridx='"+a+"']");if(0==c.length)throw Error("Row index out of range.");return b.multiSelect||this.resetSelection(),c.addClass("selected"),c.find(".igrid-check input:checkbox, .igrid-radio input:radio").prop("checked",!0),e=b.grid.find("tbody input:checked"),e.length==b.paginator.pageSize&&b.grid.find("thead input:checkbox").prop("checked",!0),b.igrid},setRowUnselected:function(a){var e,b=d[this.guid],c=b.grid.find("tr[data-ridx='"+a+"']");if(0==c.length)throw Error("Row index out of range.");return c.removeClass("selected"),c.find(".igrid-check input:checkbox, .igrid-radio input:radio").prop("checked",!1),e=b.grid.find("tbody input:not(:checked)"),e.length==b.paginator.pageSize&&b.grid.find("thead input:checkbox").prop("checked",!1),b.igrid},getData:function(){return this.valid()?d[this.guid].data||[]:(Bb("you have some wrong data in the grid, please check your input and try again."),null)},getCurPageData:function(){return nb(d[this.guid])},setCell:function(a,b,c){var e=d[this.guid].grid.find("tr[data-ridx='"+a+"'] td[data-field='"+b+"']");if(0==e.length)throw Error("Can not find the cell of row["+a+"] column["+b+"] .");return e.html(c),rb(d[this.guid],a,b,c),d[this.guid].igrid},getCell:function(a,b){var c=d[this.guid].grid.find("tr[data-ridx='"+a+"'] td[data-field='"+b+"']");if(0==c.length)throw Error("Can not find the cell of row["+a+"] column["+b+"] .");return pb(d[this.guid],a,b)},editCell:function(a,b){var c=d[this.guid],e=c.grid.find("tr[data-ridx='"+a+"'] td[data-field='"+b+"']");if(0==e.length)throw Error("Can not find the cell of row[{0}] column[{1}] .".format(a,b));return O(e,c.isWebKit),c.igrid},saveCell:function(a,b){var f,g,c=d[this.guid],e=c.grid.find("tr[data-ridx='"+a+"'] td[data-field='"+b+"']");if(0==e.length)throw Error("Can not find the cell of row[{0}] column[{1}] .".format(a,b));return f=c.isWebKit?e:e.find("[contenteditable]"),g=x(f,a,b,c),g===!1?!1:(e.removeClass("editable").html(g).prop("contenteditable",!1),c.igrid)},saveRow:function(b){var c=d[this.guid],e=c.grid.find("tr[data-ridx='"+b+"']");if(0==e.length)throw Error("Can not find the row[{0}] .".format(b));return e.find("td.editable").each(function(){var d=c.isWebKit?a(this):a(this).find("[contenteditable]"),e=x(d,b,field,c);return e===!1?!1:(a(this).removeClass("editable").html(e).prop("contenteditable",!1),void 0)}),c.igrid},resetSelection:function(){var a=d[this.guid];return a.grid.find("tr.selected").removeClass("selected"),a.grid.find(".igrid-check input:checkbox, .igrid-radio input:radio").prop("checked",!1),a.igrid},destroy:function(){var b=d[this.guid];b.grid.off("click","tbody td").off("dblclick","tbody td").off("blur","tbody td").empty().data("guid",void 0).insertBefore(b.root),b.root.remove(),a("#igrid-"+this.guid+"-waiting").remove(),d[this.guid]=null},storeStatus:function(a){var b=d[this.guid],c={url:i(b.request.url),page:b.paginator.pageIndex,size:b.paginator.pageSize,row:a,param:b.request.param};sessionStorage.setItem("igridStatus",JSON.stringify(c))},valid:function(){return 0==d[this.guid].grid.find(".input-error").length}},Fb={toInt:function(a,b){if(!a)return 0;"string"==typeof a&&a.contains(",")&&(a=a.replace(",",""));var c=parseInt(a,10);return!b&&isNaN(c)?0:c},toFloat:function(a,b){if(!a)return 0;"string"==typeof a&&a.contains(",")&&(a=a.replace(",",""));var c=parseFloat(a);return!b&&isNaN(c)?0:c},toMoney:function(a,b){return this.toFloat(a).toFixed(b||2)},formatDate:function(a,b){var d,e,f,g,h,i,j,k;if(!a)return"";if("string"==typeof a){if(0==a.indexOf("0001"))return"";a=a.replace(/\-/g,"/").replace("T"," ").split(".")[0]}try{a=new Date(a)}catch(c){throw c}switch(d=a.getYear(),e=a.getFullYear(),f=a.getMonth()+1,g=a.getDate(),h=a.getHours(),i=a.getMinutes(),j=a.getSeconds(),k="",b){case"yyyy-MM-dd":k=e+"-"+(f>=10?f:"0"+f)+"-"+(g>=10?g:"0"+g);break;case"yy-MM-dd":k=d+"-"+(f>=10?f:"0"+f)+"-"+(g>=10?g:"0"+g);break;case"yyyy/MM/dd":k=e+"/"+(f>=10?f:"0"+f)+"/"+(g>=10?g:"0"+g);break;case"yy/MM/dd":k=d+"/"+(f>=10?f:"0"+f)+"/"+(g>=10?g:"0"+g);break;case"yyyy/MM/dd hh:mm:ss":k=e+"/"+(f>=10?f:"0"+f)+"/"+(g>=10?g:"0"+g)+" "+(h>=10?h:"0"+h)+":"+(i>=10?i:"0"+i)+":"+(j>=10?j:"0"+j);
break;case"yy/MM/dd hh:mm:ss":k=d+"/"+(f>=10?f:"0"+f)+"/"+(g>=10?g:"0"+g)+" "+(h>=10?h:"0"+h)+":"+(i>=10?i:"0"+i)+":"+(j>=10?j:"0"+j);break;case"yy-MM-dd hh:mm:ss":k=d+"-"+(f>=10?f:"0"+f)+"-"+(g>=10?g:"0"+g)+" "+(h>=10?h:"0"+h)+":"+(i>=10?i:"0"+i)+":"+(j>=10?j:"0"+j);break;case"yyyy-MM-dd HH:mm:ss":default:k=e+"-"+(f>=10?f:"0"+f)+"-"+(g>=10?g:"0"+g)+" "+(h>=10?h:"0"+h)+":"+(i>=10?i:"0"+i)+":"+(j>=10?j:"0"+j)}return k}},Gb={zh_CN:{unit:"条",total:"共{0}页，｛1｝条",current:"当前第｛0｝页",first:"首页",last:"尾页",prev:"上一页",next:"下一页",subtotal:"小计",summation:"合计"},en:{unit:"",total:"total {0} pages, {1} records",current:"page {0}",first:"first",last:"last",prev:"prev",next:"next",subtotal:"subtotal",summation:"summation"}},Hb=function(a,b){return Gb[b][a]},Array.prototype.select||(Array.prototype.select=function(a){var b=0,c=this.length,d=[];if(0==c)return d;for(;c>b;)b in this&&this[b]&&("string"==typeof a&&this[b].hasOwnProperty(a)?d.push(this[b][a]):"function"==typeof a&&d.push(a.call(this,this[b],b,this))),b++;return d}),Array.prototype.sum||(Array.prototype.sum=function(a){var b=0,c=this.length,d=0;if(0==c)return d;for(;c>b;)d+=a.call(this,this[b],b,this),b++;return d}),Array.prototype.count||(Array.prototype.count=function(a){var b=0,c=this.length,d=0;if(0==c)return d;for(;c>b;)a.call(this,this[b],b,this)&&d++,b++;return d}),Array.prototype.every||(Array.prototype.every=function(a){var b=0,c=this.length;if(0==c)return!0;for(;c>b;){if(b in this&&!a.call(this,this[b],b,this))return!1;b++}return!0}),Array.prototype.all||(Array.prototype.all=function(a){var b=0,c=this.length;if(0==c)return!0;for(;c>b;){if(b in this&&!a.call(this,this[b],b,this))return!1;b++}return!0}),Array.prototype.any||(Array.prototype.any=function(a){var b=0,c=this.length;if(0==c)return!1;for(;c>b;){if(b in this&&a.call(this,this[b],b,this))return!0;b++}return!1}),Array.prototype.first||(Array.prototype.first=function(a){var b=0,c=this.length;if(0==c)return null;for(;c>b;){if(b in this&&a.call(this,this[b],b,this))return this[b];b++}return null}),Array.prototype.forEach||(Array.prototype.forEach=function(a){var d,b=0,c=this.length;if(0!=c)for(;c>b;){if(b in this){if(d=this[b],a.call(this,d,b,this)===!1)break;this[b]=d}b++}}),Array.prototype.where||(Array.prototype.where=function(a){var b=0,c=this.length,d=[];if(0==c)return d;for(;c>b;)b in this&&a.call(this,this[b],b,this)&&d.push(this[b]),b++;return d}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),Array.prototype.max||(Array.prototype.max=function(a){var d,f,g,e,b=1,c=this.length;if(0==c)return null;for(d=this[0],e=a&&"function"==typeof a;c>b;)f=e?a.call(this,d,b-1,this):d,g=e?a.call(this,this[b],b,this):this[b],b in this&&g>=f&&(d=this[b]),b++;return d}),Array.prototype.min||(Array.prototype.min=function(a){var d,f,g,e,b=1,c=this.length;if(0==c)return null;for(d=this[0],e=a&&"function"==typeof a;c>b;)f=e?a.call(this,d,b-1,this):d,g=e?a.call(this,this[b],b,this):this[b],b in this&&f>=g&&(d=this[b]),b++;return d}),Array.prototype.contains||(Array.prototype.contains=function(a){if("function"!=typeof a)return this.indexOf(a)>=0;var b=0,c=this.length;if(0==c)return!1;for(;c>b;){if(b in this&&a.call(this,this[b],b,this))return!0;b++}return!1}),Array.prototype.remove||(Array.prototype.remove=function(a){var b=this.length,c=b-1,d=[];if(0!=b){for(;c>=0;)c in this&&a.call(this,this[c],c,this)&&d.push(c),c--;for(c=0;c<d.length;c++)this.splice(d[c],1)}}),Array.prototype.distinct||(Array.prototype.distinct=function(a){var e,b=this.length,c=0,d=[];if(0==b)return d;for(;b>c;)e=this[c],c in this&&e&&("string"==typeof a&&e.hasOwnProperty(a)&&!d.contains(function(b){return b[a]==e[a]})?d.push(e):"object"==typeof a&&a instanceof Array&&!d.contains(function(b){return a.all(function(a){return e.hasOwnProperty(a)&&b[a]==e[a]})})&&d.push(e)),c++;return d}),Array.prototype.equal||(Array.prototype.equal=function(a){if(!(a instanceof Array))return!1;var b=0,c=this.length;if(c!=a.length)return!1;for(;c>b;){if(this[b]!=a[b])return!1;b++}return!0}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^(\s*)(\S+.*\S+)(\s*)$/,"$2")}),String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^(\s*)(\S+.*)$/,"$2")}),String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/^(.*\S+)(\s*)$/,"$1")}),String.prototype.contains||(String.prototype.contains=function(a){return this.indexOf(a)>=0}),String.prototype.startWith||(String.prototype.startWith=function(a,b){return b?0==this.toLowerCase().indexOf(a.toLowerCase()):0==this.indexOf(a)}),String.prototype.format||(String.prototype.format=function(){var a,b;return 0==arguments.length?this:(a=arguments,b=this.replace(/\{(\d)\}/g,function(b,c){return a[parseInt(c,10)]}))}),String.prototype.toSeparate||(String.prototype.toSeparate=function(){var f,a=0==this.indexOf("-"),b=(a?this.replace("-",""):this).split("."),c=[],d=b[0].split("").reverse(),e=b[1];for(f=0;f<d.length;f++)c.push(d[f]),0==(f+1)%3&&f+1<d.length&&c.push(",");return(a?"-":"")+c.reverse().join("")+(e?"."+e:"")}),Number.prototype.toSeparate||(Number.prototype.toSeparate=function(){return this.toString(10).toSeparate()})});